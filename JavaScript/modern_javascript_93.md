# 42장. 비동기 프로그래밍



**본 내용은 모던 자바스크립트 Deep Dive - 자바스크립트의 기본 개념과 동작 원리를 토대로 작성하였습니다.**



## 42.1 동기 처리와 비동기 처리

* 함수의 실행 순서는 실행 컨텍스트 스택으로 관리
* 함수가 실행되면 함수 실행 컨텍스트가 생성
* 생성된 함수 실행 컨텍스트는 실행 컨텍스트 스택에 푸시
  * 함수 실행의 시작
* 함수 코드가 실행
* 함수 코드의 실행이 종료하면 함수 실행 컨텍스트는 실행 컨텍스트 스택에 팝되어 제거
* **자바스크립트 엔진은 단 하나의 실행 컨텍스트 스택을 가짐**
  * 함수를 실행할 수 있는 창구가 단 하나
  * 동시에 2개 이상의 함수를 실행 불가
* **싱글 스레드**
  * 한 번에 하나의 태스크만 실행 가능
* **블로킹**
  * 작업 중단
  * 처리에 시간이 걸리는 태스크를 실행하는 경우
* **동기 처리**
  * 실행 중인 태스크가 종료할 때까지 실행될 태스크가 대기하는 방식
  * 실행 순서가 보장
  * 이후 태스크들이 블로킹 됨
* **비동기 처리**
  * 실행 중인 태스크가 종료되지 않아도 다음 태스크를 곧바로 실행하는 방식
  * 블로킹이 발생하지 않음
  * 실행 순서가 보장되지 않음



## 42.2 이벤트 루프와 태스크 큐

* **자바스크립트의 동시성**
  * 자바스크립트는 싱글스레드이지만, 브라우저의 동작은 많은 태스크가 처리되는 것 처럼 보임
  * **이벤트 루프**가 자바스크립트의 동시성을 지원ㅇ
* **이벤트 루프**
  * 브라우저에 내장되어 있는 기능
* **브라우저는 멀티스레드로 동작**



### 42.2.1 자바스크립트 엔진

* 크게 2개의 영역
* **콜 스택**
  * 실행 컨텍스트 스택 그 자체
  * 함수를 호출하면 함수 실행 컨텍스트가 콜 스택에 푸시되어 순차적으로 실행
* **힙**
  * 객체가 저장되는 메모리 공간
  * 실행 컨텍스트는 힙에 저장된 객체를 참조
  * 객체는 크기가 정해져 있지 않아 메모리 공간의 크기를 런타임에 동적으로 할당



### 42.2.2 브라우저 환경 또는 Node.js 환경

* 태스크 큐
  * 비동기 함수의 콜백 함수 또는 이벤트 핸들러가 일시적으로 보관되는 영역
  * 태스크 큐와는 별도로 프로미스의 후속 처리 메서드의 콜백 함수가 일시 보관되는 마이크로 태스크 큐도 존재
  * 일시 보관된 함수들은 비동기 처리 방식으로 동작
* 이벤트 루프
  * 콜 스택에 실행 중인 실행 컨텍스트가 있는지, 태스크 큐에 대기 중인 함수가 있는지 반복해서 확인
  * 콜 스택이 비어 있고 태스크 큐에 대기 중인 함수가 있으면 순차적으로(FIFO, First In First Out) 태스크 큐에 대기중인 함수를 콜 스택으로 이동
  * 콜 스택으로 이동한 함수는 실행